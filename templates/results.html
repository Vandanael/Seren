<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ titre_page }}</title>

    <!-- Modern minimal UI framework -->
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">

    <style>
        /* Optional tweaks to stay close to your original layout */
        .article-card {
            padding: 1rem;
            border: 1px solid #e5e5e5;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            background: var(--card-background-color, #fff);
        }

        .source {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 0.5rem;
            display: block;
        }

        .choice-form {
            text-align: right;
            margin-top: 0.5rem;
        }

        .choice-button {
            background-color: #2c8f4e;
        }

        .chosen-ref {
            padding: 1rem;
            border-left: 4px solid #007bff;
            background: #eef6ff;
            margin-bottom: 1.5rem;
        }

        .diversity-note {
            color: #c0392b;
            font-weight: bold;
        }

        .serendipity-section {
            border-top: 2px dashed #ccc;
            padding-top: 1rem;
            margin-top: 2rem;
        }

        .back-button {
            margin-top: 1.5rem;
        }
    </style>
</head>

<body>
    <main class="container">
        <h1>{{ titre_page }}</h1>

        {% if stage == 'initial' %}
            <h2>Phase 1 : Le "Random" Nécessaire</h2>
            <p>
                Nous avons sélectionné 5 articles de domaines très variés (pour briser votre bulle).
                <strong>Choisissez celui qui éveille le plus votre curiosité</strong> :
                ce choix nous servira d'ancrage pour vous proposer des articles de sérendipité.
            </p>

            {% for article in articles %}
            <div class="article-card">
                <span class="source">Source : {{ article.source }}</span>
                <h2><a href="{{ article.lien }}" target="_blank">{{ article.titre }}</a></h2>
                <p>{{ article.resume | safe | truncate(200) }}</p>

                <form class="choice-form" action="{{ url_for('choose') }}" method="POST">
                    <input type="hidden" name="article_id" value="{{ article.id }}">
                    <button type="submit" class="choice-button">Choisir cet article</button>
                </form>
            </div>
            {% endfor %}

        {% elif stage == 'serendipity' %}

            <div class="chosen-ref">
                <h3>Ancrage de Pertinence (Votre Choix) :</h3>
                <p>
                    Vous avez choisi :
                    <strong>{{ article_choisi.titre }}</strong>
                    (Source : {{ article_choisi.source }})
                </p>
            </div>

            <div class="serendipity-section">
                <h2>Phase 2 : Le Reranking Serendipitous</h2>
                <p>
                    Voici vos articles de <strong>Sérendipité</strong> :
                    ils sont similaires à votre choix (haute pertinence)
                    mais proviennent de <strong>sources différentes</strong>.
                </p>

                {% for article in articles %}
                <div class="article-card">
                    <span class="source">
                        Source : {{ article.source }}
                        <span class="diversity-note">(Diversité !)</span>
                    </span>
                    <h2><a href="{{ article.lien }}" target="_blank">{{ article.titre }}</a></h2>
                    <p>{{ article.resume | safe | truncate(200) }}</p>
                </div>
                {% else %}
                    <p>
                        Aucune recommandation de sérendipité trouvée pour le moment.
                        Veuillez réessayer avec un autre article initial.
                    </p>
                {% endfor %}
            </div>

            <a href="{{ url_for('home') }}" class="back-button">Recommencer (Nouveau Cycle de Sérendipité)</a>

        {% endif %}
    </main>
</body>
</html>
